<pre><code># 선착순 쿠폰 발급 API 시퀀스 다이어그램 (락 제외 간소화 버전) ```mermaid sequenceDiagram actor Client participant API_Gateway as API Gateway participant Coupon_Service as Coupon Service participant DB Client->>API_Gateway: 쿠폰 발급 요청 (쿠폰 ID 포함) API_Gateway->>Coupon_Service: 쿠폰 발급 처리 요청 Coupon_Service->>DB: 사용자 중복 발급 여부 확인 alt 이미 발급됨 DB-->>Coupon_Service: 중복 발급 Coupon_Service-->>API_Gateway: 중복 발급 응답 API_Gateway-->>Client: 이미 발급된 쿠폰입니다 else 발급 가능 DB-->>Coupon_Service: 미발급 상태 Coupon_Service->>DB: 쿠폰 수량 조회 alt 수량 0 DB-->>Coupon_Service: 수량 없음 Coupon_Service-->>API_Gateway: 쿠폰 마감 응답 API_Gateway-->>Client: 쿠폰이 모두 소진되었습니다 else 수량 있음 DB-->>Coupon_Service: 수량 확인 완료 Coupon_Service->>DB: 수량 차감 및 발급 이력 저장 DB-->>Coupon_Service: 저장 완료 Coupon_Service-->>API_Gateway: 발급 성공 응답 API_Gateway-->>Client: 쿠폰 발급 완료 end end ``` </code></pre>